<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
<title>Nebula Pro ‚Äî Dual Editor (Optimized)</title>

<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#000c19">

<script src="https://cdn.jsdelivr.net/npm/feather-icons@4.29.0/dist/feather.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/idb-keyval@6.2.1/dist/umd.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/search/searchcursor.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closetag.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/selection/active-line.min.js"></script>

<style>
  :root{
    --bg: #0f1114; --panel: #15171a; --gutter-bg: #1d2126;
    --accent-1: #63e6ff; --accent-2: #b87cff; --text: #e6ebf3;
    --muted: #9fb4c8; --radius: 14px; --stroke: rgba(255,255,255,0.08);
    --mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    --maxw: 1400px;
    --header-h: 70px;
    --footer-h: 80px;
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  /* CRITICAL FIX: Ensure full height structure */
  html, body {
    height: 100%;
    margin: 0; padding: 0;
    background: radial-gradient(circle at 10% 10%, rgba(99,230,255,0.04), transparent 25%), 
                radial-gradient(circle at 90% 90%, rgba(184,124,255,0.04), transparent 25%), 
                #0f1114;
    color: var(--text);
    font-family: Inter, system-ui, -apple-system, sans-serif;
    overflow: hidden; /* Prevent body scroll, handle inside app */
  }

  .app {
    display: flex;
    flex-direction: column;
    height: 100dvh; /* Dynamic Viewport Height for Mobile */
    max-width: var(--maxw);
    margin: 0 auto;
    padding: calc(12px + env(safe-area-inset-top)) 12px calc(80px + env(safe-area-inset-bottom)) 12px;
    gap: 12px;
  }

  /* Header */
  .header {
    flex-shrink: 0;
    display: flex; align-items: center; justify-content: space-between;
    padding: 10px 12px;
    border-radius: 16px; border: 1px solid var(--stroke);
    background: rgba(255,255,255,0.02); backdrop-filter: blur(10px);
  }
  .brand { display: flex; align-items: center; gap: 12px; }
  .logo-box { width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, rgba(99,230,255,0.1), rgba(184,124,255,0.1)); display: grid; place-items: center; border: 1px solid rgba(255,255,255,0.05); }
  .title { font-weight: 700; font-size: 15px; }
  .subtitle { font-size: 11px; color: var(--muted); margin-top: 2px; }

  /* Tabs */
  .tabs { flex-shrink: 0; display: flex; gap: 8px; overflow-x: auto; padding-bottom: 2px; -webkit-overflow-scrolling: touch; }
  .tab { padding: 6px 14px; border-radius: 99px; border: 1px solid var(--stroke); background: rgba(255,255,255,0.02); color: var(--muted); font-weight: 500; font-size: 13px; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 6px; transition: 0.2s; }
  .tab.active { background: rgba(255,255,255,0.08); color: #fff; border-color: rgba(255,255,255,0.2); }
  
  /* MAIN PANEL - FLEX FIX */
  .panel {
    flex: 1; /* Grow to fill space */
    min-height: 0; /* CRITICAL: Allows flex child to shrink properly on Safari */
    border-radius: var(--radius);
    border: 1px solid var(--stroke);
    background: #131518;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* Views */
  .view {
    display: none;
    flex: 1;
    min-height: 0; /* CRITICAL */
    flex-direction: column;
    height: 100%;
    overflow: hidden;
  }
  .view.active { display: flex; }

  /* Editor Styling Improvements */
  .editor-wrapper {
    flex: 1;
    position: relative;
    overflow: hidden;
    height: 100%;
  }
  
  /* CodeMirror Custom Theme Overrides */
  .CodeMirror {
    height: 100% !important;
    font-family: var(--mono);
    font-size: 13px;
    line-height: 1.6;
    background: transparent;
    color: var(--text);
  }
  .CodeMirror-gutters {
    background: var(--gutter-bg);
    border-right: 1px solid var(--stroke);
    white-space: nowrap;
  }
  .CodeMirror-linenumber { color: #5c6370; }
  .CodeMirror-cursor { border-left: 2px solid var(--accent-1); }
  .CodeMirror-activeline-background { background: rgba(255,255,255,0.03); }
  .cm-s-default .cm-tag { color: #e06c75; }
  .cm-s-default .cm-attribute { color: #d19a66; }
  .cm-s-default .cm-string { color: #98c379; }
  .cm-s-default .cm-keyword { color: #c678dd; }
  
  /* Search & Toolbar */
  .search-bar { position: absolute; right: 18px; top: 12px; z-index: 50; display: flex; gap: 6px; align-items: center; background: #1a1d21; padding: 6px; border-radius: 8px; border: 1px solid var(--stroke); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
  .search-bar input { background: transparent; border: none; color: var(--text); padding: 4px 8px; width: 180px; font-size: 13px; outline: none; }
  .overlay-tools { position: absolute; left: 12px; top: 12px; z-index: 40; display: flex; gap: 6px; pointer-events: none; }
  .overlay-tools > * { pointer-events: auto; }

  /* Preview - THE FIX */
  .preview-wrap {
    flex: 1;
    min-height: 0; /* CRITICAL */
    display: flex;
    flex-direction: column;
    background: #fff;
    position: relative;
  }
  .preview-bar {
    height: 36px;
    flex-shrink: 0;
    background: #0d1117; color: #8b949e;
    display: flex; align-items: center; padding: 0 12px;
    font-size: 11px; border-bottom: 1px solid #30363d;
  }
  iframe.preview {
    flex: 1; /* Grow inside flex container */
    width: 100%;
    height: auto; /* Allow flex to dictate height */
    min-height: 0; /* Safari fix */
    border: 0;
    display: block;
    background: #fff;
  }

  /* Assets View */
  .assets-view { padding: 16px; overflow-y: auto; }
  .asset-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; margin-top: 12px; }
  .asset-card { background: rgba(255,255,255,0.03); border: 1px solid var(--stroke); border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; }
  .asset-thumb { height: 80px; background: rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; overflow: hidden; }
  .asset-thumb img { width: 100%; height: 100%; object-fit: cover; }
  .asset-info { padding: 8px; }
  .asset-name { font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; }
  .asset-actions { display: flex; gap: 4px; margin-top: 6px; }

  /* Bottom Toolbar */
  .toolbar-bottom {
    position: fixed; left: 0; right: 0; bottom: 0;
    padding: 12px 12px calc(12px + env(safe-area-inset-bottom));
    background: rgba(15,17,20,0.9); backdrop-filter: blur(12px);
    border-top: 1px solid var(--stroke);
    z-index: 100;
  }
  .toolbar-grid { display: grid; grid-template-columns: 1fr 1fr 2fr 1fr; gap: 8px; max-width: var(--maxw); margin: 0 auto; }
  .tb-btn { height: 50px; border-radius: 12px; border: 1px solid var(--stroke); background: linear-gradient(180deg, #1a1d21, #15171a); color: var(--muted); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 3px; font-size: 10px; font-weight: 500; cursor: pointer; transition: 0.1s; }
  .tb-btn:active { transform: scale(0.96); }
  .tb-btn.primary { background: linear-gradient(135deg, var(--accent-1), var(--accent-2)); color: #000; border: none; font-weight: 700; }
  
  /* Utils */
  .chip { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; background: rgba(255,255,255,0.06); border: 1px solid var(--stroke); color: var(--muted); cursor: pointer; display: inline-flex; align-items: center; justify-content: center; }
  .chip:hover { background: rgba(255,255,255,0.12); color: #fff; }
  .toast { position: fixed; bottom: 100px; left: 50%; transform: translate(-50%, 20px); background: #0f1216; border: 1px solid var(--stroke); color: #fff; padding: 10px 20px; border-radius: 30px; font-size: 13px; font-weight: 500; opacity: 0; pointer-events: none; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 200; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 8px; }
  .toast.show { opacity: 1; transform: translate(-50%, 0); }
  .cm-search-highlight { background: rgba(255, 235, 59, 0.3); border-bottom: 2px solid #ffeb3b; }
</style>
</head>
<body>

<div class="app">
  <header class="header">
    <div class="brand">
      <div class="logo-box">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>
      </div>
      <div>
        <div class="title">Nebula Pro</div>
        <div class="subtitle">v3.0 ‚Ä¢ Optimized Core</div>
      </div>
    </div>
    <div class="chip" id="xp-display">Lvl 1</div>
  </header>

  <nav class="tabs">
    <div class="tab active" data-target="editor"><i data-feather="code" width="14"></i> Code</div>
    <div class="tab" data-target="preview"><i data-feather="play" width="14"></i> Preview</div>
    <div class="tab" data-target="assets"><i data-feather="image" width="14"></i> Assets</div>
  </nav>

  <main class="panel">
    
    <div id="view-editor" class="view active">
      <div class="editor-wrapper">
        <textarea id="code-area" style="display:none;"></textarea>
        
        <div class="overlay-tools">
          <button class="chip" id="btn-find" title="Ctrl+F">Find</button>
          <button class="chip" id="btn-undo">Undo</button>
        </div>

        <div class="search-bar" id="search-bar" style="display:none;">
          <input id="search-input" placeholder="Find..." />
          <button class="chip" id="search-prev">‚ñ≤</button>
          <button class="chip" id="search-next">‚ñº</button>
          <button class="chip" id="search-close" style="color:#ff7b72">‚úï</button>
        </div>
      </div>
    </div>

    <div id="view-preview" class="view">
      <div class="preview-wrap">
        <div class="preview-bar">
          <span>Sandbox Rendering</span>
          <span style="margin-left:auto" id="preview-size">0 KB</span>
        </div>
        <iframe id="preview-frame" class="preview"></iframe>
      </div>
    </div>

    <div id="view-assets" class="view assets-view">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0; font-size:16px;">Local Assets</h3>
        <button class="chip" onclick="document.getElementById('hidden-input').click()">+ Upload</button>
      </div>
      <div style="font-size:12px; color:var(--muted); margin:8px 0;">Files stored in browser IndexedDB.</div>
      <div id="asset-list" class="asset-grid"></div>
    </div>

  </main>
</div>

<input type="file" id="hidden-input" multiple style="display:none" />
<div id="toast" class="toast"><i data-feather="check-circle" width="16"></i><span id="toast-msg">Saved</span></div>

<div class="toolbar-bottom">
  <div class="toolbar-grid">
    <button class="tb-btn" id="btn-open"><span style="font-size:16px">üìÇ</span>Open</button>
    <button class="tb-btn" id="btn-save"><span style="font-size:16px">üíæ</span>Save</button>
    <button class="tb-btn primary" id="btn-run"><span style="font-size:18px">‚ñ∂Ô∏è</span>Run</button>
    <button class="tb-btn" id="btn-export"><span style="font-size:16px">üì§</span>Export</button>
  </div>
</div>

<script>
feather.replace();

// --- CONFIG ---
const STORAGE_KEY = 'nebula_pro_code';
const ASSETS_KEY = 'nebula_pro_assets';
const XP_KEY = 'nebula_pro_xp';

// --- STATE ---
let cmEditor = null;
let objectUrls = [];
let currentXP = 0;
let lastSearchQuery = '';
let lastSearchCursor = null;

// --- DEFAULT TEMPLATE ---
function getDefaultTemplate(){
  return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nebula Project</title>
<style>
  body { 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: #f0f2f5; color: #333; 
    display: flex; justify-content: center; align-items: center; 
    height: 100vh; margin: 0;
  }
  .card { 
    background: white; padding: 2rem; border-radius: 16px; 
    box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center;
    max-width: 400px;
  }
  h1 { color: #6366f1; margin-bottom: 0.5rem; }
  button {
    background: #6366f1; color: white; border: none; padding: 10px 20px;
    border-radius: 8px; cursor: pointer; font-size: 1rem; margin-top: 1rem;
  }
  button:hover { background: #4f46e5; }
</style>
</head>
<body>
  <div class="card">
    <h1>Hello, World! üöÄ</h1>
    <p>This is a live preview of your code.</p>
    <button onclick="alert('It works!')">Click Me</button>
  </div>
</body>
</html>`;
}

// --- INIT ---
(async function init(){
  // 1. Setup CodeMirror with Native Gutter & Better Config
  cmEditor = CodeMirror(document.querySelector('.editor-wrapper'), {
    mode: 'htmlmixed',
    lineNumbers: true, // Native gutter
    lineWrapping: true,
    tabSize: 2,
    indentWithTabs: false,
    theme: 'default', // Using custom CSS overrides instead of loading a theme file
    autoCloseTags: true,
    autoCloseBrackets: true,
    matchBrackets: true,
    styleActiveLine: true,
    inputStyle: 'contenteditable' // Better for mobile
  });

  // Ensure CodeMirror fills the flex container
  cmEditor.setSize('100%', '100%');

  // 2. Load Content
  try {
    const saved = await idbKeyval.get(STORAGE_KEY);
    const xp = await idbKeyval.get(XP_KEY);
    cmEditor.setValue(saved || getDefaultTemplate());
    if(xp) { currentXP = xp; updateXPDisplay(); }
  } catch(e) {
    cmEditor.setValue(getDefaultTemplate());
  }

  // 3. Listeners
  cmEditor.on('change', () => { debounceSave(); });

  setupTabs();
  setupButtons();
  setupSearch();
  loadAssetsRender();
  
  // Clean URL on exit
  window.addEventListener('beforeunload', () => {
    objectUrls.forEach(u => URL.revokeObjectURL(u));
  });
})();

// --- TABS & LAYOUT ---
function setupTabs(){
  const tabs = document.querySelectorAll('.tab');
  const views = document.querySelectorAll('.view');
  
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      // Toggle Classes
      tabs.forEach(t => t.classList.remove('active'));
      views.forEach(v => v.classList.remove('active'));
      tab.classList.add('active');
      const targetId = 'view-' + tab.dataset.target;
      document.getElementById(targetId).classList.add('active');

      // Refresh CodeMirror if visible (prevents blank editor glitch)
      if(tab.dataset.target === 'editor' && cmEditor){
        setTimeout(() => cmEditor.refresh(), 50);
      }
    });
  });
}

// --- SAVE SYSTEM ---
let saveTimeout;
function debounceSave(){
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(() => {
    idbKeyval.set(STORAGE_KEY, cmEditor.getValue());
  }, 800);
}

// --- PREVIEW LOGIC ---
async function runPreview(){
  const frame = document.getElementById('preview-frame');
  let code = cmEditor.getValue();

  // Clear old assets
  objectUrls.forEach(u => URL.revokeObjectURL(u));
  objectUrls = [];

  // Inject Assets
  const assets = (await idbKeyval.get(ASSETS_KEY)) || [];
  for(const asset of assets){
    try {
      const blob = new Blob([asset.data], {type: asset.type});
      const url = URL.createObjectURL(blob);
      objectUrls.push(url);
      // Regex replace for precise matching
      const reg = new RegExp(escapeRegExp(asset.name), 'g');
      code = code.replace(reg, url);
    } catch(e){ console.error(e); }
  }

  // Calculate size
  const blobSize = new Blob([code]).size;
  document.getElementById('preview-size').textContent = (blobSize/1024).toFixed(1) + ' KB';

  // Render via Blob (Safest for mobile)
  const pageBlob = new Blob([code], {type: 'text/html'});
  const pageUrl = URL.createObjectURL(pageBlob);
  objectUrls.push(pageUrl);
  frame.src = pageUrl;
}

// --- BUTTONS ---
function setupButtons(){
  // Run
  document.getElementById('btn-run').onclick = () => {
    runPreview();
    document.querySelector('[data-target="preview"]').click();
    addXP(5);
  };
  
  // Save Manual
  document.getElementById('btn-save').onclick = () => {
    debounceSave();
    showToast('Saved successfully');
    addXP(2);
  };

  // Open
  document.getElementById('btn-open').onclick = () => {
    const input = document.createElement('input');
    input.type = 'file'; input.accept = '.html,.js,.css,.txt';
    input.onchange = e => {
      const file = e.target.files[0];
      if(!file) return;
      const r = new FileReader();
      r.onload = ev => {
        cmEditor.setValue(ev.target.result);
        document.querySelector('[data-target="editor"]').click();
        showToast('File Opened');
      };
      r.readAsText(file);
    };
    input.click();
  };

  // Export
  document.getElementById('btn-export').onclick = () => {
    const blob = new Blob([cmEditor.getValue()], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'nebula-export.html';
    a.click();
    addXP(10);
    showToast('Exporting...');
  };

  // Undo
  document.getElementById('btn-undo').onclick = () => {
    cmEditor.undo();
    cmEditor.focus();
  };
  
  // Asset Upload
  document.getElementById('hidden-input').onchange = async e => {
    const files = Array.from(e.target.files);
    if(!files.length) return;
    const assets = (await idbKeyval.get(ASSETS_KEY)) || [];
    
    for(const f of files){
      const buf = await f.arrayBuffer();
      assets.unshift({
        id: crypto.randomUUID(),
        name: f.name,
        type: f.type,
        data: buf
      });
    }
    await idbKeyval.set(ASSETS_KEY, assets);
    loadAssetsRender();
    showToast('Assets Uploaded');
    addXP(files.length * 10);
    e.target.value = ''; // reset
  };
}

// --- SEARCH ---
function setupSearch(){
  const bar = document.getElementById('search-bar');
  const input = document.getElementById('search-input');
  
  const closeSearch = () => {
    bar.style.display = 'none';
    if(cmEditor) cmEditor.focus();
  };

  document.getElementById('btn-find').onclick = () => {
    bar.style.display = 'flex';
    input.focus();
    input.select();
  };
  
  document.getElementById('search-close').onclick = closeSearch;
  
  const find = (rev = false) => {
    const q = input.value;
    if(!q) return;
    const cursor = cmEditor.getSearchCursor(q, rev ? cmEditor.getCursor('from') : cmEditor.getCursor('to'));
    if(!cursor.find(rev)) {
      // wrap around
      const nc = cmEditor.getSearchCursor(q, rev ? {line:cmEditor.lineCount()-1, ch:0} : {line:0,ch:0});
      if(!nc.find(rev)) return; // not found
      cursor.from = nc.from; cursor.to = nc.to;
    }
    cmEditor.setSelection(cursor.from(), cursor.to());
    cmEditor.scrollIntoView({from: cursor.from(), to: cursor.to()}, 20);
  };

  document.getElementById('search-next').onclick = () => find(false);
  document.getElementById('search-prev').onclick = () => find(true);
  input.onkeydown = e => {
    if(e.key === 'Enter') { e.preventDefault(); find(e.shiftKey); }
    if(e.key === 'Escape') closeSearch();
  };
}

// --- ASSET RENDER ---
async function loadAssetsRender(){
  const list = document.getElementById('asset-list');
  list.innerHTML = '';
  const assets = (await idbKeyval.get(ASSETS_KEY)) || [];
  
  if(!assets.length){
    list.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:20px;color:var(--muted)">No assets uploaded.</div>`;
    return;
  }

  assets.forEach(a => {
    const blob = new Blob([a.data], {type: a.type});
    const url = URL.createObjectURL(blob); // Note: leaks if not revoked, but fine for small list in SPA
    
    const div = document.createElement('div');
    div.className = 'asset-card';
    const isImg = a.type.startsWith('image/');
    div.innerHTML = `
      <div class="asset-thumb">
        ${isImg ? `<img src="${url}">` : `<i data-feather="file" color="#fff"></i>`}
      </div>
      <div class="asset-info">
        <div class="asset-name">${a.name}</div>
        <div class="asset-actions">
          <div class="chip" onclick="insertAsset('${a.name}', '${a.type}')">Insert</div>
          <div class="chip" style="color:#ff7b72" onclick="delAsset('${a.id}')">Del</div>
        </div>
      </div>
    `;
    list.appendChild(div);
  });
  feather.replace();
}

window.insertAsset = (name, type) => {
  let tag = '';
  if(type.startsWith('image')) tag = `<img src="${name}" alt="" width="200" />`;
  else if(type.startsWith('video')) tag = `<video src="${name}" controls></video>`;
  else if(type.includes('css')) tag = `<link rel="stylesheet" href="${name}">`;
  else if(type.includes('script')) tag = `<script src="${name}"><\/script>`;
  else tag = name;
  
  cmEditor.replaceSelection(tag);
  showToast('Inserted!');
  document.querySelector('[data-target="editor"]').click();
};

window.delAsset = async (id) => {
  if(!confirm('Delete asset?')) return;
  const assets = (await idbKeyval.get(ASSETS_KEY)) || [];
  const n = assets.filter(a => a.id !== id);
  await idbKeyval.set(ASSETS_KEY, n);
  loadAssetsRender();
};

// --- UTILS ---
function addXP(n){
  currentXP += n;
  idbKeyval.set(XP_KEY, currentXP);
  updateXPDisplay();
}
function updateXPDisplay(){
  const lvl = Math.floor(currentXP / 100) + 1;
  document.getElementById('xp-display').textContent = `Lvl ${lvl} ‚Ä¢ ${currentXP}XP`;
}
function showToast(msg){
  const t = document.getElementById('toast');
  document.getElementById('toast-msg').textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}
function escapeRegExp(s) { return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
</script>
</body>
</html>
